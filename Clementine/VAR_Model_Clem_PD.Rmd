---
title: "VAR_Model_Clem"
output: html_document
---

Read cleaned data for modeling 

```{r}

library(tseries)
library(xlsx)

setwd("/Users/kevalshah/Keval_Backup/University/UChicago/Capstone/Data/Data Clean up/Clean data to be used for Analysis")

clean_clem_data <- read.xlsx("clem_social_seasonally_adjusted_v1_average_weekly.xlsx", sheetName = "7 Day MA Social+Sales")


# subset the data to have include observations that have both sales and social media data

clean_clem_data_ts <- clean_clem_data[1:260,]
clean_clem_data_ts

```


Step 1: Check if the series is stationary. If not, we need to difference the timeseries 
and obtain a stationary time series. 

```{r}

sales.volume <- clean_clem_data_ts$Sales.Volume
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(sales.volume)
#summary(d.sales.volume)

plot(week, sales.volume, main = "Clementine sales volume", xlab = "Time", ylab = "Sales Volume")




#Based on the sales volume time series, there appears to be a linear trend.

#Therefore, for stationarity test we include a trend element in augmented dickey fuller test. 

#Augmented Dickey Fuller test for stationarity 




# Sales Volume 
# Null hypothesis H0: Non - Stationary 

library(urca)

#summary(ur.df(y=sales.volume, lags = 52, type = "trend"))
adf.test(sales.volume, alternative = "stationary")

# KPSS test 
# Null hypothesis: Series is trend stationary or time trend with stationarity errors.
# Alternative: Series is non stationary 

kpss.test(sales.volume, null = "Trend")


```
ADF Test: 
Small p-value of 0.03, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary. 

KPSS Test: 
At significance level of 5% or p-value > 0.05, we can cannot reject the null hypothesis 
that the series is time trend with stationarity errors. In other words, we have 
no evidence that the alternative hypothesis is true or series is not stationary. 

:::::::::::::::::::::: SOCIAL MEDIA MENTIONS :::::::::::::::::::::::::::

FORUMS

```{r}

clem_forums <- clean_clem_data_ts$MA_7_Forums
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_forums)
#summary(d.sales.volume)

plot(week, clem_forums, main = "Clementine Forum mentions", xlab = "Time", ylab = "Forums mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(clem_forums, alternative = "stationary")

```

Small p-value of 0.01, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary. 


BLOGS

```{r}

clem_blogs <- clean_clem_data_ts$MA_7_Blogs
d.clem_blogs <- diff(clem_blogs)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_blogs)


plot(week, clem_blogs, main = "Clementine Blog mentions", xlab = "Time", ylab = "Blog mentions")


# Augmented Dickey Fuller test for stationarity 
adf.test(clem_blogs, alternative = "stationary")

# KPSS test 
# Null hypothesis: Series is trend stationary or time trend with stationarity errors.
# Alternative: Series is non stationary 

kpss.test(clem_blogs, null = "Trend")

# Low p-value suggests that the series is Non - Stationary. We reject the null hypothesis # of stationarity. Therefore, we attempt to difference the series and check for
# stationarity. 

d.week <- week[1:259]
  
  
plot(d.week, d.clem_blogs, main = "Clementine Blog mentions", xlab = "Time", ylab = "Diff Blog mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(d.clem_blogs, alternative = "stationary")


```

The difference series appears to be stationary and small p-value from ADF test of 
difference series validates that. 


REVIEWS

```{r}

clem_reviews <- clean_clem_data_ts$MA_7_Reviews
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_reviews)
#summary(d.sales.volume)

plot(week, clem_reviews, main = "Clementine Review mentions", xlab = "Time", ylab = "Review mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(clem_reviews, alternative = "stationary")

```     


Small p-value of 0.01, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary. 


FACEBOOK

```{r}

clem_facebook <- clean_clem_data_ts$MA_7_FB
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_facebook)
#summary(d.sales.volume)

plot(week, clem_facebook, main = "Clementine Facebook mentions", xlab = "Time", ylab = "Facebook mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(clem_facebook, alternative = "stationary")

```   


Small p-value of 0.01, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary. 


TWITTER

```{r}

clem_twitter <- clean_clem_data_ts$MA_7_Twitter
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_twitter)
#summary(d.sales.volume)

plot(week, clem_twitter, main = "Clementine twitter mentions", xlab = "Time", ylab = "Twitter mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(clem_twitter, alternative = "stationary")

```   

Small p-value of 0.01, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary.

COMMENTS

```{r}

clem_comments <- clean_clem_data_ts$MA_7_Comments
#d.sales.volume <- diff(sales.volume)
week <- clean_clem_data_ts$Date


# Descriptive statistics and plotting the data
summary(clem_comments)
#summary(d.sales.volume)

plot(week, clem_comments, main = "Clementine comments mentions", xlab = "Time", ylab = "Comments mentions")

# Augmented Dickey Fuller test for stationarity 
adf.test(clem_comments, alternative = "stationary")

```   

Small p-value of 0.01, less than significance level of 0.05 suggests that 
we reject the null hypothesis that the series is not stationary.

Running VAR model for Multivariate time series. 

Multivariate time series analysis is used when one
wants to model and explain the interactions and comovements
among a group of time series variables

* http://faculty.washington.edu/ezivot/econ584/notes/multivariatetimeseries.pdf 

Granger Causality
One of the main uses of VAR models is forecasting.

The following intuitive notion of a variable’s forecasting
ability is due to Granger (1969).

• If a variable, or group of variables, y1 (social media mentions) is found to be helpful for predicting another variable (sales volume), or group of variables, y2 then y1 is said to Granger-cause y2; otherwise it is said to fail to Granger-cause y2.

```{r}

library(vars)
library(astsa)

# Sum all social media mentions

sum_social_media = cbind(sales.volume, clem_forums, d.clem_blogs, clem_reviews, clem_facebook, clem_twitter, clem_comments)

plot.ts(sum_social_media , main = "", xlab = "")

summary(VAR(sum_social_media, p=2, type="both", seseason = ))

VARselect(sum_social_media, lag.max = 10, type = "both", season = NULL)


```

